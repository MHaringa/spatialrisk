<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Calculating Spatial Risk • spatialrisk</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="apple-touch-icon-60x60.png">
<script src="deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="deps/Open_Sans-0.4.9/font.css" rel="stylesheet">
<link href="deps/font-awesome-6.4.2/css/all.min.css" rel="stylesheet">
<link href="deps/font-awesome-6.4.2/css/v4-shims.min.css" rel="stylesheet">
<script src="deps/headroom-0.11.0/headroom.min.js"></script><script src="deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="deps/search-1.0.0/fuse.min.js"></script><script src="deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="pkgdown.js"></script><meta property="og:title" content="Calculating Spatial Risk">
<meta name="description" content="Methods for spatial risk calculations. It offers an efficient approach to determine the sum of all observations within a circle of a certain radius. This might be beneficial for insurers who are required (by a recent European Commission regulation) to determine the maximum value of insured fire risk policies of all buildings that are partly or fully located within a circle of a radius of 200m. See Church (1974) &lt;doi:10.1007/BF01942293&gt; for a description of the problem.">
<meta property="og:description" content="Methods for spatial risk calculations. It offers an efficient approach to determine the sum of all observations within a circle of a certain radius. This might be beneficial for insurers who are required (by a recent European Commission regulation) to determine the maximum value of insured fire risk policies of all buildings that are partly or fully located within a circle of a radius of 200m. See Church (1974) &lt;doi:10.1007/BF01942293&gt; for a description of the problem.">
<meta property="og:image" content="https://mharinga.github.io/spatialrisk/logo.png">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="index.html">spatialrisk</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.7.1.9000</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="reference/index.html">Reference</a></li>
<li class="nav-item"><a class="nav-link" href="news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/mharinga/spatialrisk/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-home">
<div class="row">
  <main id="main" class="col-md-9"><div class="section level1">
<div class="page-header">
<img src="logo.png" class="logo" alt=""><h1 id="spatialrisk-">spatialrisk <a class="anchor" aria-label="anchor" href="#spatialrisk-"></a>
</h1>
</div>
<!-- badges: start -->

<p><code>spatialrisk</code> is specifically designed for efficient spatial risk calculations, allowing users to quickly sum all observations within a defined radius. With key functions implemented in C++ using Rcpp, the package ensures fast performance for various spatial analysis tasks, including optimizing location and resource allocation.</p>
<p>One of the core challenges addressed by <code>spatialrisk</code> is the Maximal Covering Location Problem (MCLP), which focuses on finding the optimal center coordinates of a circle with a fixed radius to maximize coverage of demand points. In this framework, the center represents potential facility sites, while the demand points are the buildings or locations that require coverage. This optimization is crucial for effective service delivery and risk management across diverse fields, including urban planning and emergency services.</p>
<p>In the context of the insurance industry, the principles behind MCLP align with the European Directive 2009/138 (Solvency II), which requires insurers to assess fire risk by calculating the highest concentration of risks within a 200 m radius. While the directive does not specify a methodology, <code>spatialrisk</code> provides a systematic approach to identify high-risk clusters on a map. This capability allows insurance companies to determine their maximum exposure to catastrophic fire risks and supports them in calibrating their solvency capital requirements effectively.</p>
<div class="section level2">
<h2 id="installation">Installation<a class="anchor" aria-label="anchor" href="#installation"></a>
</h2>
<p>Install <code>spatialrisk</code> from CRAN:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html" class="external-link">install.packages</a></span><span class="op">(</span><span class="st">"spatialrisk"</span><span class="op">)</span></span></code></pre></div>
<p>Or the development version from GitHub:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># install.packages("remotes")</span></span>
<span><span class="fu">remotes</span><span class="fu">::</span><span class="fu"><a href="https://remotes.r-lib.org/reference/install_github.html" class="external-link">install_github</a></span><span class="op">(</span><span class="st">"MHaringa/spatialrisk"</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="example-1">Example 1<a class="anchor" aria-label="anchor" href="#example-1"></a>
</h2>
<p>Filter all observations in <code>Groningen</code> that fall within a circle of a radius of 100m drawn around the point <code>(lon,lat) = (6.561561,53.21326)</code>:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/mharinga/spatialrisk" class="external-link">spatialrisk</a></span><span class="op">)</span></span>
<span><span class="va">circle</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/points_in_circle.html">points_in_circle</a></span><span class="op">(</span><span class="va">Groningen</span>, lon_center <span class="op">=</span> <span class="fl">6.571561</span>, lat_center <span class="op">=</span> <span class="fl">53.21326</span>, radius <span class="op">=</span> <span class="fl">100</span><span class="op">)</span></span>
<span><span class="va">circle</span></span></code></pre></div>
<div class="sourceCode" id="cb4"><pre class="sourceCode R"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" tabindex="-1"></a><span class="do">## # A tibble: 14 × 10</span></span>
<span id="cb4-2"><a href="#cb4-2" tabindex="-1"></a><span class="do">##    street   number letter suffix postal_code city    lon   lat amount distance_m</span></span>
<span id="cb4-3"><a href="#cb4-3" tabindex="-1"></a><span class="do">##    &lt;chr&gt;     &lt;int&gt; &lt;chr&gt;  &lt;chr&gt;  &lt;chr&gt;       &lt;chr&gt; &lt;dbl&gt; &lt;dbl&gt;  &lt;dbl&gt;      &lt;dbl&gt;</span></span>
<span id="cb4-4"><a href="#cb4-4" tabindex="-1"></a><span class="do">##  1 Heresin…      5 &lt;NA&gt;   &lt;NA&gt;   9711EP      Gron…  6.57  53.2      5       31.4</span></span>
<span id="cb4-5"><a href="#cb4-5" tabindex="-1"></a><span class="do">##  2 Heresin…     11 &lt;NA&gt;   &lt;NA&gt;   9711ER      Gron…  6.57  53.2     11       47.8</span></span>
<span id="cb4-6"><a href="#cb4-6" tabindex="-1"></a><span class="do">##  3 Zuiderp…   1003 &lt;NA&gt;   &lt;NA&gt;   9724AK      Gron…  6.57  53.2   1003       57.6</span></span>
<span id="cb4-7"><a href="#cb4-7" tabindex="-1"></a><span class="do">##  4 Heresin…     13 &lt;NA&gt;   &lt;NA&gt;   9711ER      Gron…  6.57  53.2     13       68.1</span></span>
<span id="cb4-8"><a href="#cb4-8" tabindex="-1"></a><span class="do">##  5 Hereple…     10 &lt;NA&gt;   &lt;NA&gt;   9711GA      Gron…  6.57  53.2     10       74.6</span></span>
<span id="cb4-9"><a href="#cb4-9" tabindex="-1"></a><span class="do">##  6 Heresin…     16 &lt;NA&gt;   &lt;NA&gt;   9711ES      Gron…  6.57  53.2     16       84.1</span></span>
<span id="cb4-10"><a href="#cb4-10" tabindex="-1"></a><span class="do">##  7 Heresin…      6 &lt;NA&gt;   &lt;NA&gt;   9711ES      Gron…  6.57  53.2      6       86.2</span></span>
<span id="cb4-11"><a href="#cb4-11" tabindex="-1"></a><span class="do">##  8 Heresin…      6 a      &lt;NA&gt;   9711ES      Gron…  6.57  53.2      6       87.8</span></span>
<span id="cb4-12"><a href="#cb4-12" tabindex="-1"></a><span class="do">##  9 Heresin…      6 b      &lt;NA&gt;   9711ES      Gron…  6.57  53.2      6       90.9</span></span>
<span id="cb4-13"><a href="#cb4-13" tabindex="-1"></a><span class="do">## 10 Heresin…     20 &lt;NA&gt;   &lt;NA&gt;   9711ET      Gron…  6.57  53.2     20       91.5</span></span>
<span id="cb4-14"><a href="#cb4-14" tabindex="-1"></a><span class="do">## 11 Heresin…     20 a      &lt;NA&gt;   9711ET      Gron…  6.57  53.2     20       93.0</span></span>
<span id="cb4-15"><a href="#cb4-15" tabindex="-1"></a><span class="do">## 12 Heresin…     15 a      &lt;NA&gt;   9711ER      Gron…  6.57  53.2     15       95.1</span></span>
<span id="cb4-16"><a href="#cb4-16" tabindex="-1"></a><span class="do">## 13 Zuiderp…   1007 &lt;NA&gt;   &lt;NA&gt;   9724AK      Gron…  6.57  53.2   1007       97.2</span></span>
<span id="cb4-17"><a href="#cb4-17" tabindex="-1"></a><span class="do">## 14 Zuiderp…     25 a      &lt;NA&gt;   9724AJ      Gron…  6.57  53.2     25       97.8</span></span></code></pre></div>
<p>The sum of all observations within this circle is equal to:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">circle</span><span class="op">$</span><span class="va">amount</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb6"><pre class="sourceCode R"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" tabindex="-1"></a><span class="do">## [1] 2163</span></span></code></pre></div>
<p>The next example shows how to determine the sum of all observations within a circle with a certain radius for multiple points.</p>
</div>
<div class="section level2">
<h2 id="example-2">Example 2<a class="anchor" aria-label="anchor" href="#example-2"></a>
</h2>
<p><code><a href="reference/concentration.html">concentration()</a></code> determines the sum of all observations within a circle of a certain radius for multiple points. Find for each row in <code>df</code> the sum of all observations in <code>Groningen</code> within a circle of a radius of 100m from the <code>(lon,lat)</code> pair:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>location <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"p1"</span>, <span class="st">"p2"</span>, <span class="st">"p3"</span><span class="op">)</span>, </span>
<span>                 lon <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">6.561561</span>, <span class="fl">6.561398</span>, <span class="fl">6.571561</span><span class="op">)</span>, </span>
<span>                 lat <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">53.21369</span>, <span class="fl">53.21326</span>, <span class="fl">53.21326</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">conc</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/concentration.html">concentration</a></span><span class="op">(</span><span class="va">df</span>, <span class="va">Groningen</span>, value <span class="op">=</span> <span class="va">amount</span>, radius <span class="op">=</span> <span class="fl">100</span><span class="op">)</span></span>
<span><span class="va">conc</span></span></code></pre></div>
<div class="sourceCode" id="cb8"><pre class="sourceCode R"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" tabindex="-1"></a><span class="do">##   location      lon      lat concentration</span></span>
<span id="cb8-2"><a href="#cb8-2" tabindex="-1"></a><span class="do">## 1       p1 6.561561 53.21369           775</span></span>
<span id="cb8-3"><a href="#cb8-3" tabindex="-1"></a><span class="do">## 2       p2 6.561398 53.21326          2271</span></span>
<span id="cb8-4"><a href="#cb8-4" tabindex="-1"></a><span class="do">## 3       p3 6.571561 53.21326          2163</span></span></code></pre></div>
<p>Show that result is indeed equal to the result from Example 1:</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Logic.html" class="external-link">isTRUE</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">circle</span><span class="op">$</span><span class="va">amount</span><span class="op">)</span> <span class="op">==</span> <span class="va">conc</span><span class="op">$</span><span class="va">concentration</span><span class="op">[</span><span class="fl">3</span><span class="op">]</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb10"><pre class="sourceCode R"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" tabindex="-1"></a><span class="do">## [1] TRUE</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="example-3">Example 3<a class="anchor" aria-label="anchor" href="#example-3"></a>
</h2>
<p>Example 2 shows how to determine the sum of all observations within a circle of certain radius for multiple points. <code><a href="reference/find_highest_concentration.html">find_highest_concentration()</a></code> can be used to determine the central coordinates of a circle with a constant radius that maximizes the coverage of demand points. As an example this is applied to data set <code>Groningen</code>.</p>
<p>Show all points in data set <code>Groningen</code>:</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="reference/plot_points.html">plot_points</a></span><span class="op">(</span><span class="va">Groningen</span>, value <span class="op">=</span> <span class="st">"amount"</span><span class="op">)</span></span></code></pre></div>
<p><img src="reference/figures/example3a-1.png" alt="Map with points in Groningen" width="672"></p>
<p><br></p>
<hr>
<p>Find the central coordinates of a circle with the highest concentration:</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">hconc</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/find_highest_concentration.html">find_highest_concentration</a></span><span class="op">(</span><span class="va">Groningen</span>, </span>
<span>                                    value <span class="op">=</span> <span class="st">"amount"</span>, </span>
<span>                                    radius <span class="op">=</span> <span class="fl">200</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb13"><pre class="sourceCode R"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" tabindex="-1"></a><span class="do">## Time difference of 0.563406 secs</span></span></code></pre></div>
<p>Note that all functions are written in C++, and are therefore very fast.</p>
<p>Output highest concentration:</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">hc</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span></span></code></pre></div>
<div class="sourceCode" id="cb15"><pre class="sourceCode R"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" tabindex="-1"></a><span class="do">##        lon      lat concentration cell id</span></span>
<span id="cb15-2"><a href="#cb15-2" tabindex="-1"></a><span class="do">## 1 6.547326 53.23658         64438 3642  1</span></span></code></pre></div>
<p>Plot the points in the highest concentration highest concentration. The sum of all values is equal to the concentration. This concentration is the highest in data set Groningen.</p>
<p>Show the highest concentration on a map (the highest concentration includes two apartment buildings with many objects):</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">hc</span><span class="op">)</span></span></code></pre></div>
<p><img src="reference/figures/unnamed-chunk-9-1.png" alt="Map with highest concentrations" width="672"></p>
<p><br></p>
<hr>
<p>Its also possible to show the coordinates for more than one concentration. To show the second and third highest concentration:</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">hconc</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/find_highest_concentration.html">find_highest_concentration</a></span><span class="op">(</span><span class="va">Groningen</span>, </span>
<span>                                    value <span class="op">=</span> <span class="st">"amount"</span>, </span>
<span>                                    radius <span class="op">=</span> <span class="fl">200</span>, </span>
<span>                                    top_n <span class="op">=</span> <span class="fl">3</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb18"><pre class="sourceCode R"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" tabindex="-1"></a><span class="do">## Finished 1 of 3Finished 2 of 3Finished 3 of 3</span></span></code></pre></div>
<p>Create interactive map:</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">hconc</span><span class="op">)</span></span></code></pre></div>
<p><img src="reference/figures/unnamed-chunk-11-1.png" alt="Interactive map with highest concentrations" width="672"></p>
<p><br></p>
<hr>
<p>Show objects in the highest circle:</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">hc</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span></span></code></pre></div>
<div class="sourceCode" id="cb21"><pre class="sourceCode R"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" tabindex="-1"></a><span class="do">## # A tibble: 208 × 13</span></span>
<span id="cb21-2"><a href="#cb21-2" tabindex="-1"></a><span class="do">##    street        number letter suffix postal_code city    lon   lat amount    ix</span></span>
<span id="cb21-3"><a href="#cb21-3" tabindex="-1"></a><span class="do">##    &lt;chr&gt;          &lt;int&gt; &lt;chr&gt;  &lt;chr&gt;  &lt;chr&gt;       &lt;chr&gt; &lt;dbl&gt; &lt;dbl&gt;  &lt;dbl&gt; &lt;int&gt;</span></span>
<span id="cb21-4"><a href="#cb21-4" tabindex="-1"></a><span class="do">##  1 Elzenlaan        135 &lt;NA&gt;   &lt;NA&gt;   9741ND      Gron…  6.55  53.2    135 20449</span></span>
<span id="cb21-5"><a href="#cb21-5" tabindex="-1"></a><span class="do">##  2 Elzenlaan        139 &lt;NA&gt;   &lt;NA&gt;   9741ND      Gron…  6.55  53.2    139 23229</span></span>
<span id="cb21-6"><a href="#cb21-6" tabindex="-1"></a><span class="do">##  3 Elzenlaan         70 &lt;NA&gt;   &lt;NA&gt;   9741NG      Gron…  6.55  53.2     70   585</span></span>
<span id="cb21-7"><a href="#cb21-7" tabindex="-1"></a><span class="do">##  4 Elzenlaan         68 &lt;NA&gt;   &lt;NA&gt;   9741NG      Gron…  6.55  53.2     68 14677</span></span>
<span id="cb21-8"><a href="#cb21-8" tabindex="-1"></a><span class="do">##  5 Duindoornstr…      1 &lt;NA&gt;   &lt;NA&gt;   9741NM      Gron…  6.55  53.2     12 16828</span></span>
<span id="cb21-9"><a href="#cb21-9" tabindex="-1"></a><span class="do">##  6 Duindoornstr…     17 &lt;NA&gt;   &lt;NA&gt;   9741NM      Gron…  6.55  53.2     17 12829</span></span>
<span id="cb21-10"><a href="#cb21-10" tabindex="-1"></a><span class="do">##  7 Duindoornstr…     15 &lt;NA&gt;   &lt;NA&gt;   9741NM      Gron…  6.55  53.2     15 16004</span></span>
<span id="cb21-11"><a href="#cb21-11" tabindex="-1"></a><span class="do">##  8 Duindoornstr…     21 &lt;NA&gt;   &lt;NA&gt;   9741NM      Gron…  6.55  53.2     21 11748</span></span>
<span id="cb21-12"><a href="#cb21-12" tabindex="-1"></a><span class="do">##  9 Duindoornstr…     13 &lt;NA&gt;   &lt;NA&gt;   9741NM      Gron…  6.55  53.2     13  2006</span></span>
<span id="cb21-13"><a href="#cb21-13" tabindex="-1"></a><span class="do">## 10 Ranonkelstra…     38 &lt;NA&gt;   &lt;NA&gt;   9741LT      Gron…  6.55  53.2     38 19696</span></span>
<span id="cb21-14"><a href="#cb21-14" tabindex="-1"></a><span class="do">## # ℹ 198 more rows</span></span>
<span id="cb21-15"><a href="#cb21-15" tabindex="-1"></a><span class="do">## # ℹ 3 more variables: distance_m &lt;dbl&gt;, id &lt;int&gt;, conc &lt;dbl&gt;</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="example-4">Example 4<a class="anchor" aria-label="anchor" href="#example-4"></a>
</h2>
<p><code>spatialrisk</code> also offers features for creating choropleth maps, which can be challenging in R. <code><a href="reference/points_to_polygon.html">points_to_polygon()</a></code> provides an elegant solution to this issue.</p>
<p>Typically, creating choropleths involves aggregating data at the regional level of the shapefile and then merging this aggregated data with the shapefile. However, this method can be problematic if the names in the data do not match those in the shapefile, such as when there are differences in punctuation or spelling in area names. To address this, <code><a href="reference/points_to_polygon.html">points_to_polygon()</a></code> uses the longitude and latitude of a point to accurately map it to the corresponding region. This approach simplifies the creation of choropleth maps at various regional levels.</p>
<p>For example, <code><a href="reference/points_to_polygon.html">points_to_polygon()</a></code> can be used to visualize the total sum insured at the municipality level across the Netherlands:</p>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">gemeente_sf</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/points_to_polygon.html">points_to_polygon</a></span><span class="op">(</span><span class="va">nl_gemeente</span>, <span class="va">insurance</span>, <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">amount</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><code><a href="reference/choropleth.html">choropleth()</a></code> generates a map from the simple feature object created in the previous step. There are two ways to create a choropleth map: if you set the mode to plot, it produces a static map. The clustering in this case is based on the Fisher-Jenks algorithm, a widely used method for classifying data in choropleth maps.</p>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="reference/choropleth.html">choropleth</a></span><span class="op">(</span><span class="va">gemeente_sf</span>, mode <span class="op">=</span> <span class="st">"plot"</span>, legend_title <span class="op">=</span> <span class="st">"Sum insured (EUR)"</span>, n <span class="op">=</span> <span class="fl">5</span><span class="op">)</span></span></code></pre></div>
<p><img src="reference/figures/nl_choro1.png" alt="Static choropleth on gemeente level" width="672"></p>
<p><br></p>
<p>If <code>mode</code> is set to <code>view</code> an interactive map is created:</p>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="reference/choropleth.html">choropleth</a></span><span class="op">(</span><span class="va">gemeente_sf</span>, mode <span class="op">=</span> <span class="st">"view"</span>, legend_title <span class="op">=</span> <span class="st">"Sum insured (EUR)"</span><span class="op">)</span></span></code></pre></div>
<p><img src="reference/figures/nl_choro2.png" alt="Interactive choropleth on gemeente level" width="672"></p>
<p><br></p>
<p>The following simple feature objects are available in <code>spatialrisk</code>: <code>nl_provincie</code>, <code>nl_corop</code>, <code>nl_gemeente</code>, <code>nl_postcode1</code>, <code>nl_postcode2</code>, <code>nl_postcode3</code>, <code>nl_postcode4</code>, <code>world_countries</code>, and <code>europe_countries</code>.</p>
</div>
</div>
  </main><aside class="col-md-3"><div class="links">
<h2 data-toc-skip>Links</h2>
<ul class="list-unstyled">
<li><a href="https://cloud.r-project.org/package=spatialrisk" class="external-link">View on CRAN</a></li>
<li><a href="https://github.com/mharinga/spatialrisk/" class="external-link">Browse source code</a></li>
<li><a href="https://github.com/mharinga/spatialrisk/issues" class="external-link">Report a bug</a></li>
</ul>
</div>

<div class="license">
<h2 data-toc-skip>License</h2>
<ul class="list-unstyled">
<li>GPL (&gt;= 2)</li>
</ul>
</div>


<div class="citation">
<h2 data-toc-skip>Citation</h2>
<ul class="list-unstyled">
<li><a href="authors.html#citation">Citing spatialrisk</a></li>
</ul>
</div>

<div class="developers">
<h2 data-toc-skip>Developers</h2>
<ul class="list-unstyled">
<li>Martin Haringa <br><small class="roles"> Author, maintainer </small>  </li>
</ul>
</div>

<div class="dev-status">
<h2 data-toc-skip>Dev status</h2>
<ul class="list-unstyled">
<li><a href="https://cran.r-project.org/package=spatialrisk" class="external-link"><img src="https://www.r-pkg.org/badges/version/spatialrisk" alt="CRAN Status"></a></li>
<li><a href="https://cran.r-project.org/package=spatialrisk" class="external-link"><img src="https://cranlogs.r-pkg.org/badges/spatialrisk?color=blue" alt="Downloads"></a></li>
</ul>
</div>

  </aside>
</div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Martin Haringa.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer>
</div>





  </body>
</html>
